<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro | Loja Espricio</title>
    <link rel="stylesheet" href="/css/style.css"> 
    <style>
        .link-voltar { display: block; text-align: center; margin-top: 15px; color: #666; text-decoration: none; font-size: 14px;}
        .link-voltar:hover { color: #764ba2; }
        
        /* Estilo para mensagem de erro/sucesso */
        .aviso { 
            text-align: center; 
            margin-top: 10px; 
            font-size: 14px; 
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <h2>Crie sua Conta</h2>
        
        <form id="signupForm">
            <div class="input-group">
                <input type="text" id="nomeNew" required placeholder="Nome Completo">
            </div>
            <div class="input-group">
                <input type="text" id="cpfNew" required placeholder="CPF (somente números)" maxlength="11">
            </div>
            <div class="input-group">
                <input type="email" id="emailNew" required placeholder="E-mail">
            </div>
            <div class="input-group">
                <input type="password" id="senhaNew" required placeholder="Senha (min. 8 chars, 1 maiúscula)">
            </div>
            
            <button type="submit" id="btnCadastrar">CADASTRAR</button>
        </form>

        <div id="mensagemCadastro" class="aviso"></div>

        <a href="/" class="link-voltar">← Voltar para Login</a>
    </div>

    <script>
        // URL da sua API (Baseada no seu dashboard)
        const API_URL = 'https://api-lojaespricio.onrender.com/clientes';

        const form = document.getElementById('signupForm');
        const msgDiv = document.getElementById('mensagemCadastro');

        form.addEventListener('submit', async (e) => {
            e.preventDefault(); // Impede a página de recarregar
            
            // 1. Pega os valores dos inputs
            const nome = document.getElementById('nomeNew').value;
            const cpf = document.getElementById('cpfNew').value;
            const email = document.getElementById('emailNew').value;
            const senha = document.getElementById('senhaNew').value;

            // 2. Monta o objeto exatamente igual ao seu Banco de Dados
            const novoCliente = {
                nomeCliente: nome,
                cpfCliente: cpf,
                emailCliente: email,
                senhaCliente: senha
            };

            // Muda o texto do botão para dar feedback visual
            const btn = document.getElementById('btnCadastrar');
            const textoOriginal = btn.innerText;
            btn.innerText = "CADASTRANDO...";
            btn.disabled = true;
            msgDiv.innerText = "";

            try {
                // 3. Envia para a API usando FETCH
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(novoCliente)
                });

                if (response.ok) {
                    // Sucesso!
                    msgDiv.style.color = "green";
                    msgDiv.innerText = "Conta criada com sucesso! Redirecionando...";
                    
                    // Espera 2 segundos e manda para o login
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                } else {
                    // Erro da API (ex: CPF já existe)
                    const erro = await response.json(); // Tenta ler mensagem de erro da API
                    msgDiv.style.color = "red";
                    msgDiv.innerText = "Erro ao cadastrar: " + (erro.message || "Verifique os dados.");
                    restaurarBotao();
                }

            } catch (error) {
                console.error(error);
                msgDiv.style.color = "red";
                msgDiv.innerText = "Erro de conexão com o servidor.";
                restaurarBotao();
            }

            function restaurarBotao() {
                btn.innerText = textoOriginal;
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>